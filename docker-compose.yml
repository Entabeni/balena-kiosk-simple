version: "2"
volumes:
  settings:
  cookies:
  cups:
services:
  browser:
    build: ./browser
    ports:
      - "5011" # management API (optional)
      - "35173" # Chromium debugging port (optional)
    depends_on:
      - "websocket"
      - "cups"
    privileged: true
    environment:
      - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/host/run/dbus/system_bus_socket
    labels:
      io.balena.features.supervisor-api: "1"
    network_mode: host
    volumes:
      - "settings:/data"
  websocket:
    privileged: true
    network_mode: host
    restart: always
    build: ./websocket
    ports:
      - "80"
      - "8888:8888"
    labels:
      io.balena.features.kernel-modules: "1"
      io.balena.features.firmware: "1"
      io.balena.features.dbus: "1"
      io.balena.features.supervisor-api: "1"
      io.balena.features.balena-api: "1"
  purge:
    restart: always
    build: ./purge
    privileged: true
    network_mode: host
    labels:
      io.balena.features.kernel-modules: "1"
      io.balena.features.firmware: "1"
      io.balena.features.dbus: "1"
      io.balena.features.supervisor-api: "1"
      io.balena.features.balena-api: "1"
  cups:
    build: ./cups
    depends_on:
      - "websocket"
    ports:
      - "80"
    privileged: true

    restart: always
    environment:
      - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/host/run/dbus/system_bus_socket
    network_mode: host
    volumes:
      - "cups:/etc/cups"
    labels:
      io.balena.features.kernel-modules: "1"
      io.balena.features.firmware: "1"
      io.balena.features.dbus: "1"
      io.balena.features.supervisor-api: "1"
      io.balena.features.balena-api: "1"
